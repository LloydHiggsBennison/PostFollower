<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Postfollower</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“±</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f0fdf4; min-height: 100vh; }
        
        .app { display: flex; min-height: 100vh; }
        
        .sidebar { width: 260px; background: linear-gradient(180deg, #064e3b 0%, #059669 100%); color: white; padding: 1.5rem; display: flex; flex-direction: column; position: fixed; height: 100vh; }
        
        .logo { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; color: white; margin-bottom: 2rem; }
        .logo-icon { font-size: 1.75rem; }
        .logo-text { font-size: 1.2rem; font-weight: 700; }
        .logo-highlight { color: #6ee7b7; }
        
        .nav { flex: 1; }
        .nav a { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 0.75rem; color: rgba(255,255,255,0.7); text-decoration: none; margin-bottom: 0.5rem; transition: all 0.2s; }
        .nav a:hover { background: rgba(255,255,255,0.1); color: white; }
        .nav a.active { background: rgba(255,255,255,0.15); color: white; font-weight: 500; }
        
        .sidebar-footer { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem; }
        .user-card { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .user-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #34d399); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .user-name { font-weight: 500; font-size: 0.9rem; }
        .user-plan { font-size: 0.75rem; color: #6ee7b7; }
        .btn-logout { width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; }
        
        .main { flex: 1; margin-left: 260px; padding: 2rem; }
        
        .header { margin-bottom: 2rem; }
        .header h1 { font-size: 1.75rem; font-weight: 700; color: #064e3b; margin-bottom: 0.5rem; }
        .header p { color: #6b7280; }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .stat-label { font-size: 0.875rem; color: #64748b; margin-bottom: 0.5rem; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #1e293b; }
        .stat-value.highlight { color: #10b981; }
        
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        
        .panel { background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .panel-title { font-size: 1.1rem; font-weight: 600; color: #064e3b; margin-bottom: 1.25rem; }
        
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.8rem; font-weight: 500; color: #374151; margin-bottom: 0.4rem; }
        .form-group input, .form-group select { width: 100%; padding: 0.7rem; font-size: 0.9rem; border: 1.5px solid #e5e7eb; border-radius: 0.5rem; outline: none; }
        .form-group input:focus, .form-group select:focus { border-color: #10b981; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        
        .btn-generate { width: 100%; padding: 0.9rem; font-size: 0.95rem; font-weight: 600; color: white; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; margin-top: 0.5rem; }
        .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 8px 20px -5px rgba(16, 185, 129, 0.4); }
        .btn-generate:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .result-box { background: #f0fdf4; border-radius: 0.75rem; padding: 1rem; max-height: 400px; overflow-y: auto; }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .credits-badge { font-size: 0.8rem; color: #10b981; font-weight: 500; }
        .btn-export { padding: 0.4rem 0.75rem; background: #10b981; color: white; border: none; border-radius: 0.4rem; cursor: pointer; font-size: 0.8rem; }
        
        .post-card { background: white; padding: 0.9rem; border-radius: 0.6rem; margin-bottom: 0.75rem; border: 1px solid #e5e7eb; }
        .post-header { display: flex; justify-content: space-between; font-size: 0.7rem; color: #6b7280; margin-bottom: 0.4rem; }
        .post-content { font-size: 0.85rem; line-height: 1.5; color: #374151; }
        .post-hashtags { margin-top: 0.5rem; font-size: 0.75rem; color: #10b981; }
        .post-copy { background: none; border: none; cursor: pointer; font-size: 0.7rem; color: #10b981; }
        
        .no-credits { background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 1rem; border-radius: 0.75rem; display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        .no-credits strong { color: #92400e; }
        .no-credits p { font-size: 0.8rem; color: #a16207; }
        .btn-upgrade { padding: 0.6rem 1.25rem; background: #f59e0b; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.85rem; }
        
        .history-item { background: #f0fdf4; padding: 0.9rem; border-radius: 0.5rem; margin-bottom: 0.75rem; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; }
        .history-item:hover { border-color: #6ee7b7; }
        .history-meta { display: flex; justify-content: space-between; font-size: 0.75rem; color: #64748b; margin-bottom: 0.4rem; }
        .history-preview { font-size: 0.8rem; color: #374151; }
        
        .plan-limit { background: #fef3c7; padding: 0.5rem 0.75rem; border-radius: 0.4rem; font-size: 0.75rem; color: #92400e; margin-bottom: 0.75rem; }
        
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .toast { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 1.5rem; background: #064e3b; color: white; border-radius: 0.75rem; font-size: 0.9rem; z-index: 1000; }
        
        @media (max-width: 1024px) { .stats { grid-template-columns: repeat(2, 1fr); } .content-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } }
        
        .section { display: none; }
        .section.active { display: block; }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ“±</span>
                <span class="logo-text">Post<span class="logo-highlight">follower</span></span>
            </a>
            <nav class="nav">
                <a href="#" class="active" onclick="showSection('generator')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    Generador
                </a>
                <a href="#" onclick="showSection('history')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    Historial
                </a>
                <a href="planes.html">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    Mejorar Plan
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div class="user-name" id="userName">Usuario</div>
                        <div class="user-plan" id="userPlan">Plan Gratis</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">Cerrar SesiÃ³n</button>
            </div>
        </aside>
        
        <main class="main">
            <div id="generatorSection" class="section active">
                <div class="header">
                    <h1>ğŸ“± Generador de Posts</h1>
                    <p>Crea contenido profesional para tus redes sociales</p>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">CrÃ©ditos</div>
                        <div class="stat-value highlight" id="credits">5</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Posts Generados</div>
                        <div class="stat-value" id="totalPosts">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Este Mes</div>
                        <div class="stat-value" id="monthPosts">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Plan</div>
                        <div class="stat-value" style="font-size: 1.1rem;" id="planName">Gratis</div>
                    </div>
                </div>
                
                <div id="noCreditsAlert" class="no-credits" style="display: none;">
                    <div style="flex:1;"><strong>âš ï¸ Sin crÃ©ditos</strong><p>Mejora tu plan</p></div>
                    <button class="btn-upgrade" onclick="location.href='planes.html'">Mejorar</button>
                </div>
                
                <div class="content-grid">
                    <div class="panel">
                        <div class="panel-title">ğŸ“ Configura tu Contenido</div>
                        <form id="genForm">
                            <div class="form-group">
                                <label>Tipo de Negocio</label>
                                <input type="text" id="businessType" placeholder="CafeterÃ­a, Tienda de ropa, Coaching..." required>
                            </div>
                            <div class="form-group">
                                <label>DescripciÃ³n (opcional)</label>
                                <input type="text" id="businessDesc" placeholder="CafÃ© de especialidad en Providencia">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Red Social</label>
                                    <select id="network">
                                        <option value="instagram">Instagram</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="twitter">Twitter/X</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Posts</label>
                                    <select id="postCount"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Tono</label>
                                <select id="tone">
                                    <option value="profesional">Profesional</option>
                                    <option value="cercano">Cercano</option>
                                    <option value="inspiracional">Inspiracional</option>
                                    <option value="humoristico">HumorÃ­stico</option>
                                </select>
                            </div>
                            <div id="planLimit" class="plan-limit" style="display:none;"></div>
                            <button type="submit" class="btn-generate" id="genBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                                Generar Posts
                            </button>
                        </form>
                    </div>
                    
                    <div class="panel">
                        <div class="result-header">
                            <span class="credits-badge" id="creditsLabel">5 crÃ©ditos</span>
                            <button class="btn-export" id="exportBtn" style="display:none;" onclick="exportPosts()">ğŸ“¥ Exportar</button>
                        </div>
                        <div class="result-box" id="result">
                            <p style="color:#9ca3af; text-align:center; padding:3rem;">Tus posts aparecerÃ¡n aquÃ­...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="historySection" class="section">
                <div class="header">
                    <h1>ğŸ“œ Historial</h1>
                    <p>Todos tus posts generados</p>
                </div>
                <div class="panel">
                    <div id="historyList">
                        <p style="color:#9ca3af; text-align:center; padding:2rem;">No tienes generaciones aÃºn</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://saas-backend-wc0y.onrender.com';
        let user = null;
        let generatedPosts = [];
        
        const PLAN_LIMITS = { gratis: 5, emprendedor: 15, agencia: 30 };
        
        function checkAuth() {
            const userData = localStorage.getItem('postfollower_user');
            if (!userData) { window.location.href = 'login.html'; return; }
            user = JSON.parse(userData);
            if (user.credits === undefined) user.credits = 5;
            updateUI();
            updatePlanOptions();
            loadHistory();
        }
        
        function updateUI() {
            document.getElementById('userName').textContent = user.name || 'Usuario';
            document.getElementById('userAvatar').textContent = (user.name || 'U')[0].toUpperCase();
            document.getElementById('userPlan').textContent = 'Plan ' + (user.plan || 'Gratis');
            document.getElementById('credits').textContent = user.credits;
            document.getElementById('creditsLabel').textContent = user.credits + ' crÃ©ditos';
            document.getElementById('planName').textContent = user.plan || 'Gratis';
            document.getElementById('totalPosts').textContent = user.totalPosts || 0;
            document.getElementById('monthPosts').textContent = user.monthPosts || 0;
            
            if (user.credits <= 0) {
                document.getElementById('noCreditsAlert').style.display = 'flex';
                document.getElementById('genBtn').disabled = true;
            }
        }
        
        function updatePlanOptions() {
            const plan = (user.plan || 'gratis').toLowerCase();
            const select = document.getElementById('postCount');
            const limit = document.getElementById('planLimit');
            
            if (plan === 'gratis') {
                select.innerHTML = '<option value="5">5 posts</option>';
                limit.style.display = 'block';
                limit.textContent = 'âš¡ Plan Gratis: mÃ¡ximo 5 posts. Mejora para generar hasta 30.';
            } else if (plan === 'emprendedor') {
                select.innerHTML = '<option value="5">5 posts</option><option value="10">10 posts</option><option value="15">15 posts</option>';
                limit.style.display = 'none';
            } else {
                select.innerHTML = '<option value="5">5 posts</option><option value="10">10 posts</option><option value="15">15 posts</option><option value="30">30 posts</option>';
                limit.style.display = 'none';
            }
        }
        
        function saveUser() {
            localStorage.setItem('postfollower_user', JSON.stringify(user));
            const users = JSON.parse(localStorage.getItem('postfollower_users') || '[]');
            const idx = users.findIndex(u => u.email === user.email);
            if (idx >= 0) { users[idx] = user; localStorage.setItem('postfollower_users', JSON.stringify(users)); }
        }
        
        function logout() { localStorage.removeItem('postfollower_user'); window.location.href = 'login.html'; }
        
        function showSection(name) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(name + 'Section').classList.add('active');
            document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
            event.target.closest('a').classList.add('active');
        }
        
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('postfollower_history') || '[]');
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<p style="color:#9ca3af; text-align:center; padding:2rem;">No tienes generaciones aÃºn</p>';
                return;
            }
            list.innerHTML = history.slice(0, 20).map((item, i) => `
                <div class="history-item" onclick="showHistoryItem(${i})">
                    <div class="history-meta">
                        <span>${item.businessType} - ${item.posts?.length || 0} posts</span>
                        <span>${new Date(item.date).toLocaleDateString('es-CL')}</span>
                    </div>
                    <div class="history-preview">${item.posts?.[0]?.content?.substring(0, 80) || ''}...</div>
                </div>
            `).join('');
        }
        
        function showHistoryItem(idx) {
            const history = JSON.parse(localStorage.getItem('postfollower_history') || '[]');
            const item = history[idx];
            if (item && item.posts) {
                displayPosts(item.posts);
                generatedPosts = item.posts;
                showSection('generator');
            }
        }
        
        document.getElementById('genForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (user.credits <= 0) { showToast('Sin crÃ©ditos'); return; }
            
            const btn = document.getElementById('genBtn');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Generando...';
            result.innerHTML = '<p style="color:#9ca3af; text-align:center; padding:3rem;">âœ¨ Generando posts...</p>';
            
            const data = {
                businessType: document.getElementById('businessType').value,
                businessDesc: document.getElementById('businessDesc').value,
                network: document.getElementById('network').value,
                postCount: parseInt(document.getElementById('postCount').value),
                tone: document.getElementById('tone').value
            };
            
            let posts = [];
            try {
                const response = await fetch(`${API_URL}/api/contenidoia/generate`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const json = await response.json();
                if (json.success && json.posts) posts = json.posts;
                else throw new Error('API error');
            } catch (err) {
                await new Promise(r => setTimeout(r, 1500));
                posts = generateDynamicPosts(data);
            }
            
            displayPosts(posts);
            generatedPosts = posts;
            
            user.credits--;
            user.totalPosts = (user.totalPosts || 0) + posts.length;
            user.monthPosts = (user.monthPosts || 0) + posts.length;
            saveUser();
            updateUI();
            
            const history = JSON.parse(localStorage.getItem('postfollower_history') || '[]');
            history.unshift({ ...data, posts, date: new Date().toISOString() });
            localStorage.setItem('postfollower_history', JSON.stringify(history.slice(0, 50)));
            loadHistory();
            
            btn.disabled = user.credits <= 0;
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg> Generar Posts';
            showToast(`Â¡${posts.length} posts generados!`);
        });
        
        function displayPosts(posts) {
            const result = document.getElementById('result');
            result.innerHTML = posts.map((post, i) => `
                <div class="post-card">
                    <div class="post-header">
                        <span>Post ${i + 1}</span>
                        <button class="post-copy" onclick="copyPost(${i})">ğŸ“‹ Copiar</button>
                    </div>
                    <div class="post-content">${post.content.replace(/\n/g, '<br>')}</div>
                    <div class="post-hashtags">${post.hashtags.join(' ')}</div>
                </div>
            `).join('');
            document.getElementById('exportBtn').style.display = 'block';
        }
        
        function generateDynamicPosts(data) {
            const count = data.postCount || 5;
            const business = data.businessType;
            const posts = [];
            
            const templates = [
                { type: 'engagement', intros: ['âœ¨ Â¿SabÃ­as que', 'ğŸ’¡ Dato curioso:', 'ğŸ¤” Te has preguntado', 'ğŸ“£ AtenciÃ³n:', 'ğŸ¯ Importante:'], actions: ['cuÃ©ntanos en comentarios ğŸ’¬', 'deja tu opiniÃ³n ğŸ‘‡', 'Â¿quÃ© opinas tÃº?', 'etiqueta a alguien ğŸ·ï¸', 'guarda este post ğŸ“Œ'] },
                { type: 'promo', intros: ['ğŸ”¥ Â¡Novedad!', 'ğŸ‰ Â¡Especial!', 'â­ Â¡Exclusivo!', 'ğŸ’¥ Â¡Imperdible!', 'ğŸš€ Â¡Ya disponible!'], actions: ['escrÃ­benos DM ğŸ“©', 'link en bio ğŸ”—', 'contÃ¡ctanos hoy', 'no te lo pierdas', 'Ãºltimas unidades'] },
                { type: 'educativo', intros: ['ğŸ“š Tip del dÃ­a:', 'ğŸ’¡ Consejo:', 'ğŸ“ Aprende:', 'âœ… CÃ³mo hacer:', 'ğŸ”‘ El secreto es:'], actions: ['guarda para despuÃ©s ğŸ“Œ', 'comparte con quien lo necesite', 'sÃ­guenos para mÃ¡s tips', 'comenta dudas ğŸ’¬', 'asÃ­ de fÃ¡cil âœ¨'] },
                { type: 'motivacional', intros: ['ğŸ’ª Recuerda:', 'ğŸŒŸ Hoy es el dÃ­a', 'âœ¨ TÃº puedes', 'ğŸ”¥ No te rindas', 'ğŸ¯ Tu meta estÃ¡ cerca'], actions: ['comparte si te identificas', 'tÃº tambiÃ©n lo lograrÃ¡s ğŸ’«', 'el Ã©xito te espera', 'cree en ti mismo', 'vamos con todo ğŸš€'] },
                { type: 'behind', intros: ['ğŸ“¸ Behind the scenes', 'ğŸ‘€ Un vistazo a', 'ğŸ¬ AsÃ­ trabajamos', 'ğŸ’¼ Nuestro dÃ­a a dÃ­a', 'ğŸ  Desde adentro'], actions: ['asÃ­ creamos magia âœ¨', 'con mucho â¤ï¸', 'para ti siempre', 'calidad garantizada', 'hecho con pasiÃ³n'] },
                { type: 'community', intros: ['ğŸ™ Gracias', 'â¤ï¸ Los queremos', 'ğŸ‘¥ Nuestra comunidad', 'ğŸŠ Celebramos juntos', 'ğŸ’• Familia'], actions: ['son los mejores ğŸ†', 'gracias por confiar', 'seguimos creciendo juntos', 'ustedes nos inspiran', 'son increÃ­bles â­'] },
                { type: 'question', intros: ['ğŸ¤” Pregunta del dÃ­a:', 'â“ CuÃ©ntanos:', 'ğŸ’­ Queremos saber:', 'ğŸ¤ Tu turno:', 'ğŸ“ Encuesta rÃ¡pida:'], actions: ['responde en comentarios ğŸ‘‡', 'A o B?', 'cuÃ©ntanos tu experiencia', 'votaciÃ³n abierta', 'nos encanta leerte ğŸ’¬'] }
            ];
            
            const hashtags = [
                [`#${business.replace(/\s/g, '')}`, '#Emprendimiento', '#Chile'],
                ['#NegocioLocal', '#Pyme', '#Calidad'],
                ['#Tips', '#Consejos', '#Aprende'],
                ['#Motivacion', '#Exito', '#Metas'],
                ['#Comunidad', '#Gracias', '#Familia'],
                ['#Trending', '#Viral', '#ParaTi']
            ];
            
            for (let i = 0; i < count; i++) {
                const template = templates[i % templates.length];
                const intro = template.intros[Math.floor(Math.random() * template.intros.length)];
                const action = template.actions[Math.floor(Math.random() * template.actions.length)];
                const hs = hashtags[Math.floor(Math.random() * hashtags.length)];
                
                let content = '';
                if (template.type === 'engagement') {
                    content = `${intro} ${business} puede transformar tu dÃ­a?\n\nDescubre por quÃ© cada vez mÃ¡s personas nos eligen ğŸŒŸ\n\nÂ¡${action}!`;
                } else if (template.type === 'promo') {
                    content = `${intro}\n\nTenemos algo especial para ti en ${business}.\n\nÂ¡${action}! ğŸ`;
                } else if (template.type === 'educativo') {
                    content = `${intro}\n\nAquÃ­ te compartimos algo valioso sobre ${business}.\n\n${action} ğŸ“š`;
                } else if (template.type === 'motivacional') {
                    content = `${intro}\n\nEn ${business} creemos en ti y en tus sueÃ±os.\n\n${action} ğŸ’ª`;
                } else if (template.type === 'behind') {
                    content = `${intro} ${business} âœ¨\n\nAsÃ­ es como trabajamos para darte lo mejor.\n\n${action}`;
                } else if (template.type === 'community') {
                    content = `${intro} por ser parte de ${business} â¤ï¸\n\nCada dÃ­a nos motivan a ser mejores.\n\n${action}`;
                } else {
                    content = `${intro}\n\nÂ¿QuÃ© es lo que mÃ¡s te gusta de ${business}?\n\n${action}`;
                }
                
                posts.push({ content, hashtags: hs });
            }
            
            return posts;
        }
        
        function copyPost(idx) {
            const post = generatedPosts[idx];
            navigator.clipboard.writeText(`${post.content}\n\n${post.hashtags.join(' ')}`).then(() => showToast('Â¡Copiado!'));
        }
        
        function exportPosts() {
            const text = generatedPosts.map((p, i) => `=== POST ${i+1} ===\n${p.content}\n\n${p.hashtags.join(' ')}`).join('\n\n---\n\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `posts_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            showToast('Â¡Exportado!');
        }
        
        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        checkAuth();
    </script>
</body>
</html>
